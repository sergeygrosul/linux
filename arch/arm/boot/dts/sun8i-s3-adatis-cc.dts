/*
*	Adatis 2021
*/

/dts-v1/;
#include "sun8i-s3.dtsi"
#include <dt-bindings/input/input.h>
#include "sunxi-common-regulators.dtsi"

/ {
	model = "Command Center V2";
	compatible = "licheepi,licheepi-zero-dock", "licheepi,licheepi-zero", "allwinner,sun8i-s3"
		     "allwinner,sun8i-v3s";

	mmc2_pwrseq: pwrseq {
		compatible = "mmc-pwrseq-emmc";
		reset-gpios = <&pio 2 2 GPIO_ACTIVE_LOW>;	// PC2
	};

	aliases {
		serial0 = &uart1;
	};

	chosen {
		stdout-path = "serial0:115200n8";
	};

    backlight: backlight {
            compatible = "pwm-backlight";
            pwms = <&pwm 0 1000000 0>;
            brightness-levels = <0 30 40 50 60 70 100>;
            default-brightness-level = <6>;
    };
            
    panel: panel {
            #address-cells = <1>;
            #size-cells = <0>;
//		 	compatible = "urt,umsh-8596md-t", "simple-panel";
			
			compatible = "simple-panel";
			pinctrl-0 = <&lcd_rgb666_pins_b>, <&lcd_power_pin_som204>;

           	enable-gpios = <&pio 1 12 0>; // PB12

            port@0 {
                    reg = <0>;
                    backlight = <&backlight>;
                    #address-cells = <1>;
                    #size-cells = <0>;

                    panel_input: endpoint@0 {
                            reg = <0>;
                            remote-endpoint = <&tcon0_out_lcd>;
                    };
            };
    };

    // STM Clock on PWM1
	stm_clk: stm_clk {
	   status = "okay";
	   compatible = "pwm";
	   pwm_id = <1>;
	   min_period = <0>;
	   max_period = <10000>;
	   duty_ns = <5000>;
	};

//	leds {
//		compatible = "gpio-leds";
//
//		blue_led {
//			label = "licheepi:blue:usr";
//			gpios = <&pio 6 1 GPIO_ACTIVE_LOW>; /* PG1 */
//		};
//
//		green_led {
//			label = "licheepi:green:usr";
//			gpios = <&pio 6 0 GPIO_ACTIVE_LOW>; /* PG0 */
//			default-state = "on";
//		};
//
//		red_led {
//			label = "licheepi:red:usr";
//			gpios = <&pio 6 2 GPIO_ACTIVE_LOW>; /* PG2 */
//		};
//	};
	

	aliases {
		ethernet0 = &emac;
	};

	leds {
		status = "disabled";
	};

};


&de {
        status = "okay";
};


&pio {
	vcc-pa-supply = <&reg_vcc3v3>;							// GMAC
	vcc-pb-supply = <&reg_vcc3v3>;							// i2s, i2c (TWI)
	vcc-pc-supply = <&reg_vcc3v3>;							// emmc
	vcc-pd-supply = <&reg_vcc3v3>;	// Added				// LCD
//	vcc-pe-supply = <&reg_ldo3>;							// CSI0	
	vcc-pf-supply = <&reg_vcc3v3>;							// SD card
	vcc-pg-supply = <&reg_vcc3v3>;	// Changed was &reg_ldo4
//	vcc-ph-supply = <&reg_ldo4>;	// Added				// CSI1
//	vcc-pi-supply = <&reg_vcc3v3>;	// Added				// i2c (TWI), UART
	
	lcd_power_pin_som204: lcd_power_pin@0 {
	        pins = "PB12";
	        function = "gpio_out";
	};



// ============ TS PINS ======================
    touchscreen_pins_a: st@0 {
        pins = "PB13";
        function = "irq";
        drive-strength = <20>;
        bias-pull-up;
    };

// ============ END TS ======================

	/*stm32@0 {
        pins = "PB3";
        function = "gpio_out";
        drive-strength = <20>;
        bias-pull-down;
    };*/
};

&pwm {
        pinctrl-names = "default";
        pinctrl-0 = <&pwm0_pins>;
        status = "okay";
};


&tcon0 {
        pinctrl-names = "default";
        pinctrl-0 = <&lcd_rgb666_pins_a>;
        status = "okay";
};
        
&tcon0_out {
        tcon0_out_lcd: endpoint@0 {
                reg = <0>;
                remote-endpoint = <&panel_input>;
        };
};


&ehci0 {
	status = "okay";
};

&mmc0 {
	broken-cd;
	bus-width = <4>;
	vmmc-supply = <&reg_vcc3v3>;
	cd-gpios = <&pio 5 6 GPIO_ACTIVE_LOW>; /* PF6 */
	status = "okay";
};

&i2c0 {
	status = "okay";

	axp209: pmic@34 {
		reg = <0x34>;
		interrupt-parent = <&nmi_intc>;
		interrupts = <0 IRQ_TYPE_LEVEL_LOW>;
	};


	// Accelerometr
	mxc4005:mxc4005@15 
	{
		compatible = "mxc4005";
		reg = <0x15>;
		interrupt-parent = <&pio>;
		interrupts = <1 11 IRQ_TYPE_LEVEL_LOW>; // PB11
	};
};


&i2c1 {
	status = "okay";

	gt911: touchscreen@14 {
        compatible = "goodix,gt911";
        reg = <0x5d>;
        interrupt-parent = <&pio>;
        interrupts = <1 13 IRQ_TYPE_EDGE_FALLING>; // (PB13) 
        pinctrl-names = "default";
        irq-gpios = <&pio 1 13 GPIO_ACTIVE_HIGH>; // (PB13) 
        reset-gpios = <&pio 1 10 GPIO_ACTIVE_HIGH>; /* RST (PB10) */
        /* touchscreen-swapped-x-y */
    };

};


&ohci0 {
	status = "okay";
};



#include "axp209.dtsi"

&ac_power_supply {
	status = "okay";
};


&battery_power_supply {
	status = "okay";
};


&reg_dcdc2 {
	regulator-always-on;
	regulator-min-microvolt = <1000000>;
	regulator-max-microvolt = <1100000>;
	regulator-name = "vdd-cpu";
};

&reg_dcdc3 {
	regulator-always-on;
	regulator-min-microvolt = <1000000>;
	regulator-max-microvolt = <3300000>;
	regulator-name = "vdd-int-dll";
};

&reg_ldo1 {
	regulator-always-on;
	regulator-min-microvolt = <1300000>;
	regulator-max-microvolt = <3300000>;
	regulator-name = "vdd-rtc";
};

&reg_ldo2 {
	regulator-always-on;
	regulator-min-microvolt = <3000000>;
	regulator-max-microvolt = <3000000>;
	regulator-name = "vcc-pa";
};

&reg_ldo3 {
	regulator-min-microvolt = <1000000>;
	regulator-max-microvolt = <1200000>;
	regulator-name = "vddio-csi0";
	regulator-soft-start;
	regulator-ramp-delay = <1600>;
};

&reg_ldo4 {
	regulator-min-microvolt = <2800000>;
	regulator-max-microvolt = <2800000>;
	regulator-name = "vddio-csi1";
	regulator-soft-start;
	regulator-ramp-delay = <1600>;
};


// Debug Console
&uart1 {
	pinctrl-0 = <&uart1_pg_pins>;
	pinctrl-names = "default";
	status = "okay";
};

// STM32 bootloader 
&uart2 {
	pinctrl-0 = <&uart2_pb_pins>;
	pinctrl-names = "default";
	status = "okay";
};



&usb_otg {
	dr_mode = "host";
	status = "okay";
};

&usbphy {
//	usb0_id_det-gpios = <&pio 5 6 GPIO_ACTIVE_HIGH>;
	status = "okay";
};


/*
&codec {
	allwinner,audio-routing =
		"Headphone", "HP",
		"Headphone", "HPCOM",
		"MIC1", "Mic",
		"Mic",  "HBIAS";
	status = "okay";
};
*/

&emac {
	phy-handle = <&int_mii_phy>;
	phy-mode = "mii";
	allwinner,leds-active-low;
	status = "okay";
};


&mmc2 {
	vmmc-supply = <&reg_vcc3v3>;
	vqmmc-supply = <&reg_vcc3v3>;
	bus-width = <8>;
	non-removable;
	mmc-pwrseq = <&mmc2_pwrseq>;
	status = "okay";

	emmc: emmc@0 {
		reg = <0>;
		compatible = "mmc-card";
		broken-hpi;
	};
};


/*&mmc1 {
	broken-cd;
	bus-width = <4>;
	vmmc-supply = <&reg_vcc3v3>;
	status = "okay";
};*/

&lradc {
	vref-supply = <&reg_vcc3v0>;
	status = "okay";
/*
	button-200 {
		label = "Volume Up";
		linux,code = <KEY_VOLUMEUP>;
		channel = <0>;
		voltage = <200000>;
	};

	button-400 {
		label = "Volume Down";
		linux,code = <KEY_VOLUMEDOWN>;
		channel = <0>;
		voltage = <400000>;
	};

	button-600 {
		label = "Select";
		linux,code = <KEY_SELECT>;
		channel = <0>;
		voltage = <600000>;
	};

	button-800 {
		label = "Start";
		linux,code = <KEY_OK>;
		channel = <0>;
		voltage = <800000>;
	};*/
};

